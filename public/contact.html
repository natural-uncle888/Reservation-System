<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="theme-color" content="#2563eb"/>
<title>聯繫名稱說明</title>
<link rel="icon" type="image/png" href="https://res.cloudinary.com/dijzndzw2/image/upload/v1757176751/logo-3_hddq08.png"/>

<!-- 完全獨立樣式：不依賴外部 CSS，不受 mobile-2col.css 影響 -->
<style>
  :root{
    --brand:#2563eb; --brand-700:#1e40af;
    --ink:#111827; --muted:#6b7280; --line:#e5e7eb; --card:#f9fafb;
    --field-font:16px; --capsule-h:52px; --capsule-radius:18px; --capsule-border:2px;
  }
  html,body{height:100%}
  body{
    font-family:"Noto Sans TC",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
    margin:0; color:var(--ink); background:#fff; font-size:16px; line-height:1.6;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  .wrap{max-width:960px;margin:0 auto;padding:20px 16px}
  h1{margin:0 0 8px;color:var(--brand)}
  .section{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px;margin:16px 0}
  .section h2{margin:0 0 10px;color:var(--brand);font-size:1.15rem}
  .row{display:grid;grid-template-columns:minmax(0,1.2fr) minmax(0,1.8fr);gap:12px;align-items:flex-start;margin:10px 0}
  .label-col{font-weight:500;color:var(--ink);padding-top:6px}
  .hint{color:var(--muted);font-size:0.85rem;margin-top:4px}
  .required{color:#dc2626;font-size:0.9rem;margin-left:4px}
  .badge{display:inline-flex;align-items:center;gap:4px;font-size:0.8rem;padding:2px 6px;border-radius:999px;background:#dbeafe;color:#1d4ed8;margin-left:4px}
  .badge svg{width:12px;height:12px}

  .field-group{display:flex;flex-direction:column;gap:6px}
  .capsules{display:flex;flex-wrap:wrap;gap:8px}
  .capsule-label{
    display:inline-flex;align-items:center;gap:8px;
    padding:10px 12px;border-radius:var(--capsule-radius);
    border:var(--capsule-border) solid #d1d5db;background:#fff;
    cursor:pointer;font-size:0.92rem;min-height:var(--capsule-h);
    transition:.15s border-color,.15s box-shadow,.15s background-color,.15s transform;
  }
  .capsule-label input{appearance:none;width:18px;height:18px;border-radius:999px;border:2px solid #9ca3af;display:inline-block;position:relative}
  .capsule-label input::after{
    content:"";position:absolute;inset:3px;border-radius:999px;background:transparent;
  }
  /* 讓有選取時顯示實心圈圈 */
  .capsule-label input:checked{
    border-color: var(--brand);
  }
  .capsule-label input:checked::after{
    background: var(--brand);
  }
  .capsule-label strong{font-weight:600}
  .capsule-label span.sub{display:block;font-size:0.8rem;color:var(--muted)}
  .capsule-label.selected{
    border-color:var(--brand);background:#eff6ff;
    box-shadow:0 0 0 1px rgba(37,99,235,.2);
    transform:translateY(-1px);
  }
  .capsule-label.selected input{border-color:var(--brand);}
  .capsule-label.selected input::after{background:var(--brand)}
  .capsule-label:hover{border-color:var(--brand-700)}

  .other-input-wrap{display:none;margin-top:8px}
  .other-input-wrap.show{display:block}

  .multi-line-group{display:flex;flex-direction:column;gap:8px}
  .multi-line-group label{font-size:0.9rem;color:var(--ink)}
  .multi-line-group .inline{display:flex;gap:8px;flex-wrap:wrap}
  .multi-line-group .inline > *{flex:1 1 160px}

  .note-box{
    border-radius:10px;border:1px dashed #93c5fd;background:#eff6ff;
    padding:10px 12px;color:#1d4ed8;font-size:0.86rem;margin-top:6px;
  }
  .note-box strong{font-weight:600}

  .nav{display:flex;justify-content:space-between;gap:8px;margin-top:20px}
  .nav a{
    flex:1;text-align:center;text-decoration:none;
    padding:12px 0;border-radius:999px;
    font-weight:600;font-size:0.95rem;
  }
  #back{
    border:1px solid #d1d5db;color:#374151;background:#fff;
  }
  #next{
    background:var(--brand);color:#fff;border:1px solid var(--brand);
  }
  #next:hover{background:var(--brand-700)}
  #back:hover{background:#f3f4f6}

  .fab-home{
    position:fixed;right:16px;bottom:16px;
    width:48px;height:48px;border-radius:999px;
    display:flex;align-items:center;justify-content:center;
    box-shadow:0 10px 20px rgba(0,0,0,.18);
    text-decoration:none;font-size:24px;
    background:var(--brand);color:#fff;
  }

  details.hint-block{margin-top:8px}
  summary{cursor:pointer;font-size:0.9rem;color:var(--brand-700)}
  details[open] summary{margin-bottom:4px}
  details ul{margin:4px 0 0 1.2em;padding:0;font-size:0.9rem;color:var(--muted)}
  details li{margin:2px 0}

  @media (max-width: 720px){
    .row{grid-template-columns:1fr;gap:4px}
    .nav{flex-direction:column}
  }
  @media (max-width: 520px){ .row{grid-template-columns:1fr;gap:6px} }

  /* 基本文字輸入體驗一致化 */
  input[type="text"],input[type="tel"],textarea,select,.other-input{
    padding:12px 12px;border:1.5px solid #d1d5db;border-radius:10px;width:100%;max-width:640px;
    font-size:var(--field-font);line-height:1.5;box-sizing:border-box;
  }
  input::placeholder,textarea::placeholder{color:#9ca3af}

  /* === 膠囊雙欄卡片（桌機與手機都 2 欄） === */
  .option-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;align-items:stretch}
  .option-grid > label.option-card{
    display:grid; grid-template-columns:24px 1fr; align-items:center; column-gap:10px;
    padding:10px 14px; min-height:var(--capsule-h);
    background:#fff; border:var(--capsule-border) solid #d1d5db; border-radius:14px;
    cursor:pointer; font-size:0.92rem;
    transition:.15s border-color,.15s box-shadow,.15s background-color,.15s transform;
  }
  .option-grid > label.option-card input{
    width:18px;height:18px;appearance:none;border-radius:999px;border:2px solid #9ca3af;position:relative;
  }
  .option-grid > label.option-card input::after{
    content:"";position:absolute;inset:3px;border-radius:999px;background:transparent;
  }
  .option-grid > label.option-card .main{font-weight:600}
  .option-grid > label.option-card .sub{font-size:0.8rem;color:var(--muted);margin-top:2px}
  .option-grid > label.option-card.selected{
    border-color:var(--brand);background:#eff6ff;
    box-shadow:0 0 0 1px rgba(37,99,235,.18);
    transform:translateY(-1px);
  }
  .option-grid > label.option-card.selected input{border-color:var(--brand)}
  .option-grid > label.option-card.selected input::after{background:var(--brand)}
  .option-grid > label.option-card:hover{border-color:var(--brand-700)}

  .section-title-row{
    display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:4px;
  }
  .section-title-row .title-main{display:flex;align-items:center;gap:6px}
  .section-title-row .title-sub{font-size:0.86rem;color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>聯繫資料與偏好</h1>
    <p style="margin:4px 0 0;color:#4b5563;font-size:0.95rem;">
      請留下方便與您聯繫的方式與時間，我們會先以「文字」與您確認細節，不會直接撥打電話打擾您。
    </p>
  </header>

  <!-- 區塊一：聯繫方式 -->
  <section class="section">
    <div class="section-title-row">
      <div class="title-main">
        <h2 style="margin:0;">與我們聯繫方式</h2>
        <span class="required">＊必填</span>
        <span class="badge">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm.75 15h-1.5v-1.5h1.5Zm0-3.75h-1.5v-6h1.5Z"/></svg>
          會先以文字聯繫
        </span>
      </div>
      <div class="title-sub">若您偏好電話，也會先以簡訊或通訊軟體詢問方便通話時間</div>
    </div>

    <div class="row">
      <div class="label-col">
        選擇一種您最方便的聯繫方式
      </div>
      <div class="field-group">
        <div class="capsules">
          <label class="capsule-label">
            <input type="radio" name="contact_method" value="LINE"/>
            <div>
              <strong>LINE</strong>
              <span class="sub">最推薦！可傳照片、影片方便溝通環境與細節</span>
            </div>
          </label>
          <label class="capsule-label">
            <input type="radio" name="contact_method" value="Facebook"/>
            <div>
              <strong>Facebook / Messenger</strong>
              <span class="sub">也可以傳照片、影片，適合平常常用 FB 的客戶</span>
            </div>
          </label>
          <label class="capsule-label">
            <input type="radio" name="contact_method" value="Phone"/>
            <div>
              <strong>電話為主</strong>
              <span class="sub">我們會先以簡訊或通訊軟體預約方便通話時間</span>
            </div>
          </label>
          <label class="capsule-label">
            <input type="radio" name="contact_method" value="Other"/>
            <div>
              <strong>其他</strong>
              <span class="sub">例如：Email、IG、公司內線…等</span>
            </div>
          </label>
        </div>

        <div class="multi-line-group">
          <label>
            若您勾選 LINE / Facebook，請填寫您的顯示名稱或帳號
          </label>
          <input type="text" name="social_name" placeholder="例：小明、Ming Chen、LINE ID、FB 名稱等"/>

          <label style="margin-top:6px;">
            若您勾選「其他」或希望以特定方式聯繫，也可以補充說明
          </label>
          <textarea name="other_contact_detail" rows="2" placeholder="例：請改用 Email 聯繫；我比較常看 IG 訊息等"></textarea>
        </div>

        <div class="note-box">
          <strong>小提醒：</strong>我們不會在未經同意的情況下加您私人帳號，會以官方帳號或簡訊與您聯繫，並只用於這次預約使用。
        </div>
      </div>
    </div>
  </section>

  <!-- 區塊二：顧客基本資訊 -->
  <section class="section">
    <div class="section-title-row">
      <div class="title-main">
        <h2 style="margin:0;">顧客與聯繫資訊</h2>
        <span class="required">＊必填</span>
      </div>
      <div class="title-sub">這些資訊僅用於聯繫與安排清洗，絕不外流或做其他用途</div>
    </div>

    <div class="row">
      <div class="label-col">顧客姓名 <span class="required">必填</span></div>
      <div class="field-group">
        <input type="text" name="name" placeholder="例：王小明"/>
      </div>
    </div>

    <div class="row">
      <div class="label-col">聯繫電話 <span class="required">必填</span></div>
      <div class="field-group">
        <input type="tel" name="phone" placeholder="請填寫 09 開頭手機或市話"/>
        <p class="hint">若希望只以文字聯繫，也請先留電話，必要時（如緊急、臨時狀況）可聯絡得到您。</p>
      </div>
    </div>

    <div class="row">
      <div class="label-col">清洗保養地址 <span class="required">必填</span></div>
      <div class="field-group">
        <input type="text" name="address" placeholder="請填寫完整地址（含縣市、區）"/>
        <p class="hint">若是社區大樓，之後可在備註補充社區名稱、棟別與管理方式：有無警衛、訪客停車等。</p>
      </div>
    </div>

    <div class="row">
      <div class="label-col">居住地型態 <span class="required">必填</span></div>
      <div class="field-group">
        <div class="option-grid">
          <label class="option-card">
            <input type="radio" name="housing_type" value="電梯大樓"/>
            <div>
              <div class="main">電梯大樓</div>
              <div class="sub">有電梯，可搭乘工具與設備</div>
            </div>
          </label>
          <label class="option-card">
            <input type="radio" name="housing_type" value="公寓（無電梯）"/>
            <div>
              <div class="main">公寓（無電梯）</div>
              <div class="sub">需走樓梯搬運工具，樓層資訊會影響安排時間與人力</div>
            </div>
          </label>
          <label class="option-card">
            <input type="radio" name="housing_type" value="透天 / 別墅"/>
            <div>
              <div class="main">透天 / 別墅</div>
              <div class="sub">如有多層樓，之後可備註主要施工樓層</div>
            </div>
          </label>
          <label class="option-card">
            <input type="radio" name="housing_type" value="其他" data-other-id="other-housing-input"/>
            <div>
              <div class="main">其他（公司、店面、廠房等）</div>
              <div class="sub">請簡單說明空間型態，方便安排人力</div>
            </div>
          </label>
        </div>
        <div id="other-housing-input" class="other-input-wrap">
          <input type="text" class="other-input" placeholder="例：公司辦公室、咖啡廳、診所、學校教室等"/>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="label-col">其他聯繫備註</div>
      <div class="field-group">
        <textarea name="contact_note" rows="3" placeholder="例：請盡量在白天聯繫；若未接電話可改傳訊；社區訪客須事先登記等。"></textarea>
      </div>
    </div>
  </section>

  <!-- 區塊三：方便聯繫時間 -->
  <section class="section">
    <div class="section-title-row">
      <div class="title-main">
        <h2 style="margin:0;">方便聯繫時間</h2>
        <span class="required">＊必填</span>
      </div>
      <div class="title-sub">我們會盡量在您方便的時段聯繫，若臨時有狀況也會以簡訊或訊息說明</div>
    </div>

    <div class="row">
      <div class="label-col">請勾選平常較方便接電話或看訊息的時段</div>
      <div class="field-group">
        <div class="option-grid">
          <label class="option-card">
            <input type="checkbox" name="contact_time_preference" value="平日白天"/>
            <div>
              <div class="main">平日白天</div>
              <div class="sub">例：09:00–17:00 上班時間，但可看訊息</div>
            </div>
          </label>
          <label class="option-card">
            <input type="checkbox" name="contact_time_preference" value="平日晚上"/>
            <div>
              <div class="main">平日晚上</div>
              <div class="sub">下班後較有空接電話或回覆訊息</div>
            </div>
          </label>
          <label class="option-card">
            <input type="checkbox" name="contact_time_preference" value="假日白天"/>
            <div>
              <div class="main">假日白天</div>
              <div class="sub">週六、週日白天時段較方便</div>
            </div>
          </label>
          <label class="option-card">
            <input type="checkbox" name="contact_time_preference" value="時間皆可"/>
            <div>
              <div class="main">時間皆可</div>
              <div class="sub">只要有來電或訊息，會盡快回覆</div>
            </div>
          </label>
        </div>

        <details class="hint-block">
          <summary>為什麼需要了解方便聯繫時間？</summary>
          <ul>
            <li>若您平日白天較忙，我們會盡量安排在您勾選的時段打電話或傳訊息。</li>
            <li>若是「時間皆可」，我們通常會在完成前一位客戶服務後，於下一個空檔聯繫您。</li>
            <li>臨時有天候或特殊狀況需要調整時間時，也會依照您提供的偏好先聯繫。</li>
          </ul>
        </details>
      </div>
    </div>
  </section>

  <!-- 導覽按鈕 -->
  <div class="nav">
    <a href="other-service.html" id="back">返回上一步</a>
    <a href="final-booking.html" id="next">下一步</a>
  </div>
</div>

<script>
  (function(){
    const KEY='BOOKING_DATA';
    const $=s=>document.querySelector(s);
    const $$=s=>Array.prototype.slice.call(document.querySelectorAll(s));

    function save(part){
      try{
        const prev = JSON.parse(localStorage.getItem(KEY)||'{}');
        localStorage.setItem(KEY, JSON.stringify(Object.assign(prev, part)));
      }catch(e){}
    }
    function collect(root=document){
      const out={};
      $$('input[name],select[name],textarea[name]', root).forEach(el=>{
        const n=el.name; if(!n) return;
        if(el.type==='checkbox'){
          if(!el.checked) return;
          (out[n]||(out[n]=[])).push(el.value);
        }else if(el.type==='radio'){
          if(!el.checked) return;
          let v=el.value;
          const oid=el.dataset.otherId;
          if(oid){
            const extra=(document.getElementById(oid)?.value||'').trim();
            if(extra) v = v+'：'+extra;
          }
          out[n]=v;
        }else{
          const v=(el.value||'').trim();
          if(v) out[n]=v;
        }
      });
      return out;
    }

    // 其他輸入框顯示/隱藏控制（支援多組別）
    function setupOtherFieldToggle(){
      document.querySelectorAll('input[type="radio"][data-other-id]').forEach(function(radio){
        const targetId = radio.getAttribute('data-other-id');
        const target = document.getElementById(targetId);
        if(!target) return;

        function toggle(){
          // 只在同名群組中有被選時顯示
          const checkedOther = document.querySelector('input[type="radio"][name="'+radio.name+'"][data-other-id]:checked');
          if(checkedOther){
            target.classList.add('show');
            setTimeout(()=>target.focus(),0);
          }else{
            target.classList.remove('show');
            target.value='';
          }
        }
        // 初始狀態與事件
        toggle();
        document.querySelectorAll('input[type="radio"][name="'+radio.name+'"]').forEach(function(r){
          r.addEventListener('change', toggle);
        });
      });
    }

    // 聯繫方式切換時，清理不同欄位的內容
    function setupContactMethodSync(){
      const radios = document.querySelectorAll('input[name="contact_method"]');
      if(!radios.length) return;
      const social = document.querySelector('input[name="social_name"]');
      const otherDetail = document.querySelector('textarea[name="other_contact_detail"]');
      function sync(){
        const checked = document.querySelector('input[name="contact_method"]:checked');
        if(!checked) return;
        const v = checked.value;
        if(v === 'Other'){
          // 改成「其他」時，自動清空上方的名稱欄位
          if(social) social.value = '';
        }else if(v === 'LINE' || v === 'Facebook'){
          // 改成 LINE / Facebook 時，自動清空下方的其他聯繫說明
          if(otherDetail) otherDetail.value = '';
        }
        // 更新 localStorage，避免預覽頁帶到舊資料
        try{
          const state = collect();
          save(state);
        }catch(e){}
      }
      radios.forEach(r => r.addEventListener('change', sync));
    }


    // 卡片選中樣式控制（radio/checkbox）
    function setupCardSelection(){
      document.querySelectorAll('.option-grid').forEach(function(group){
        group.querySelectorAll('input[type="radio"],input[type="checkbox"]').forEach(function(input){
          function refresh(){
            if(input.type==="radio"){
              group.querySelectorAll('label.option-card').forEach(function(card){
                card.classList.remove('selected');
              });
              const checked = group.querySelector('input[type="radio"]:checked');
              if(checked){ checked.closest('label.option-card')?.classList.add('selected'); }
            }else{
              if(input.checked) input.closest('label.option-card')?.classList.add('selected');
              else input.closest('label.option-card')?.classList.remove('selected');
            }
          }
          input.addEventListener('change', refresh);
          // 初始狀態
          if(input.checked) input.closest('label.option-card')?.classList.add('selected');
        });
      });
    }

    // 依照 query string 決定「返回上一步」連結
    function setupBackLink(){
      const backLink = document.getElementById('back');
      if(!backLink) return;

      try{
        const params = new URLSearchParams(window.location.search || '');
        const from = params.get('from');
        if(!from) return;

        // 可依來源頁面調整對應關係
        const backMap = {
          ac: 'other-service-ac-addon.html',
          other: 'other-service.html',
          group: 'group-booking.html',
          bulk: 'bulk-booking.html'
        };

        if(backMap[from]){
          backLink.href = backMap[from];
        }
      }catch(e){
        // 若瀏覽器不支援 URLSearchParams 或發生錯誤，就維持原本 href
      }
    }

    document.addEventListener('change', ()=> save(collect()));
    ['back','next'].forEach(id=>{
      const a=document.getElementById(id);
      if(!a) return;
      a.addEventListener('click', ()=> save(collect()), {capture:true});
    });

    document.addEventListener('DOMContentLoaded', function(){
      setupOtherFieldToggle();
      setupCardSelection();
      setupBackLink();
      setupContactMethodSync();
    });

    // 偵錯輔助
    window.debugContact=()=>collect();
    window.debugLS=()=>JSON.parse(localStorage.getItem(KEY)||'{}');
  })();
</script>
<a class="fab-home" aria-label="回首頁" href="index.html">🏠</a>

<script>
  // === 必填驗證 ===
  document.addEventListener('DOMContentLoaded', function () {
    const nextBtn = document.getElementById('next');

    if (!nextBtn) return;

    nextBtn.addEventListener('click', function (e) {
      let valid = true;
      let msg = '';

      // 1️⃣ 驗證「與我們聯繫方式」必填
      const contactSelected = document.querySelector('input[name="contact_method"]:checked');
      if (!contactSelected) {
        valid = false;
        msg = '請選擇一個聯繫方式（LINE / Facebook / 電話 / 其他）';
      }

      // 2️⃣ 驗證「LINE 或 Facebook 名稱」若選 LINE / Facebook 時必填
      if (valid && (contactSelected?.value === 'LINE' || contactSelected?.value === 'Facebook')) {
        const socialName = document.querySelector('input[name="social_name"]');
        if (!socialName.value.trim()) {
          valid = false;
          msg = '您選擇了 ' + contactSelected.value + '，請填寫名稱';
        }
      }

      // 3️⃣ 驗證「顧客姓名」必填
      if (valid) {
        const nameField = document.querySelector('input[name="name"]');
        if (!nameField.value.trim()) {
          valid = false;
          msg = '請輸入顧客姓名';
        }
      }

      // 4️⃣ 驗證「聯繫電話」必填
      if (valid) {
        const phoneField = document.querySelector('input[name="phone"]');
        if (!phoneField.value.trim()) {
          valid = false;
          msg = '請輸入聯繫電話';
        }
      }

      // 5️⃣ 驗證「清洗保養地址」必填
      if (valid) {
        const addressField = document.querySelector('input[name="address"]');
        if (!addressField.value.trim()) {
          valid = false;
          msg = '請輸入清洗保養地址';
        }
      }

      // 6️⃣ 驗證「居住地型態」必填
      if (valid) {
        const housingSelected = document.querySelector('input[name="housing_type"]:checked');
        if (!housingSelected) {
          valid = false;
          msg = '請選擇居住地型態';
        }
      }


      // 7️⃣ 驗證「方便聯繫時間」必填
      if (valid) {
        const contactTimeChecked = document.querySelectorAll('input[name="contact_time_preference"]:checked');
        if (contactTimeChecked.length === 0) {
          valid = false;
          msg = '請至少選擇一個方便聯繫時間';
        }
      }
      if (!valid) {
        e.preventDefault(); // 阻止跳轉
        alert(msg);
      }
    });
  });
</script>

</body>
</html>
