<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="#2563eb" name="theme-color"/>
<title>安排時段填寫</title>
<link href="https://res.cloudinary.com/dijzndzw2/image/upload/v1757176751/logo-3_hddq08.png" rel="icon" type="image/png"/>
<style>
    :root{--brand:#2563eb;--ink:#111827;--muted:#6b7280;--card:#f9fafb;--line:#e5e7eb}
    body{font-family:"Noto Sans TC",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;margin:0;color:var(--ink)}
    .wrap{max-width:1024px;margin:0 auto;padding:18px 16px}
    h1{margin:0 0 8px;color:var(--brand)}
    p.desc{margin:0 0 12px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .section{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px}
    .section h2{margin:0 0 8px;color:var(--brand);font-size:1.1rem}
    .group{display:flex;flex-direction:column;gap:8px}
    label{display:flex;align-items:center;gap:8px}
    input[type="text"],textarea{padding:10px;border:1px solid #d1d5db;border-radius:8px;width:100%}
    table{width:100%;border-collapse:collapse;font-size:.95rem}
    th,td{border-bottom:1px solid #eee;padding:8px;text-align:left;vertical-align:top}
    .nav{display:flex;gap:12px;margin-top:16px}
    .nav a,.nav button{flex:1;text-align:center;padding:12px 16px;background:var(--brand);color:#fff;border-radius:10px;text-decoration:none;border:none;cursor:pointer
  /* Force identical typography for <a> and <button> */
  font: 500 16px/1.5 "Noto Sans TC", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  letter-spacing: 0;
}
    .nav a:hover,.nav button:hover{background:#1e40af}
    .ok{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);align-items:center;justify-content:center}
    .ok .modal{background:#fff;border-radius:12px;padding:24px;max-width:420px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    details{background:#fff;border:1px dashed var(--line);border-radius:10px;padding:10px;margin-top:8px}
    details>summary{cursor:pointer;font-weight:700}
  

/* 其他指定時間輸入框美化修正版 */
#time_other {
  padding: 10px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  width: 100%; /* 直接填滿容器，避免超出 */
  font-size: 0.95rem;
  color: #111827;
  box-sizing: border-box; /* 確保邊框與內距不會影響寬度 */
  margin-left: 0; /* 移除多餘外距 */
}
#time_other:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
}


/* 其他備註說明輸入框對齊修正 */
textarea[name="note"] {
  display: block;
  width: 100%;
  box-sizing: border-box;
  margin: 0;       /* 移除多餘外距 */
  padding: 10px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
}


/* Normalize button defaults to match links */
button {
  font: inherit;
  -webkit-font-smoothing: inherit;
  -moz-osx-font-smoothing: inherit;
}

</style>
<link href="mobile.css" rel="stylesheet"/>
<style>
    body, html {
        max-width: 100%;
        overflow-x: hidden;
    }
    img {
        max-width: 100%;
        height: auto;
    }
    table, input, select, textarea, button {
        max-width: 100%;
        box-sizing: border-box;
    }
    </style><style>
/* ==== Card & Button Active ==== */
.card:active, .go:active, button:active {
  transform: scale(0.97);
  box-shadow: 0 2px 12px rgba(37,99,235,0.12);
  filter: brightness(0.97);
  transition: transform .05s, box-shadow .05s;
}
button, .go, .card {
  transition: box-shadow .18s, transform .10s, filter .10s;
  cursor: pointer;
}

/* ==== Visual Upgrade ==== */
.hero h1 {
  font-size: 1.9rem;
  letter-spacing: .5px;
  font-weight: 800;
  color: #2563eb;
  margin-bottom: 4px;
}
.hero p {
  color: #64748b;
  font-size: 1.04rem;
}
.grid { gap: 22px; }
.card {
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.03);
  font-size: 1rem;
}
.card h3 {
  font-size: 1.16rem;
  font-weight: 700;
  letter-spacing: .1px;
}
.card p {
  color: #6b7280;
  font-size: .99rem;
}
footer {
  margin-bottom: 0;
}

/* ==== Error Message ==== */
.input-error {
  color: #dc2626;
  background: #fef2f2;
  border-radius: 8px;
  padding: 5px 10px;
  margin-top: 4px;
  font-size: .93rem;
  font-weight: 600;
}
.form-row.error input, .form-row.error textarea, .form-row.error select {
  border: 2px solid #dc2626;
  background: #fef2f2;
}

/* ==== FAB ==== */
.fab-home {
  position: fixed; right: 18px; bottom: 72px;
  width: 54px; height: 54px;
  background: #2563eb;
  color: #fff;
  border-radius: 50%;
  box-shadow: 0 2px 12px rgba(37,99,235,0.08);
  display: flex; align-items: center; justify-content: center;
  font-size: 2.1em;
  z-index: 1010;
  text-decoration: none;
  transition: background .13s, transform .13s;
  border: none;
}
.fab-home:active { background: #1d4ed8; transform: scale(0.92);}
@media (min-width: 768px) {
  .fab-home { display: none; }
}
</style></head>
<body>
<div class="wrap">
<h1>安排時段填寫</h1>
<p class="desc">請選擇可安排時段，並補充其他說明。右側可即時預覽填寫的內容。</p>
<div class="grid">
<div class="section">
<h2>可安排時段（可複選）</h2>
<div class="group" id="timeslot">
<label><input name="timeslot" type="checkbox" value="平日"/>平日</label>
<label><input name="timeslot" type="checkbox" value="假日"/>假日</label>
<label><input name="timeslot" type="checkbox" value="上午"/>上午</label>
<label><input name="timeslot" type="checkbox" value="下午"/>下午</label>
<label><input name="timeslot" type="checkbox" value="晚上"/>晚上</label>
<label><input name="timeslot" type="checkbox" value="皆可"/>皆可</label>
<label><input data-other-id="time_other" name="timeslot" type="checkbox" value="其他指定時間"/>其他指定時間</label>
<input id="time_other" name="time_other" placeholder="例如 6/9 09:00–11:00"/>
</div>
<h2>其他備註說明</h2>
<textarea name="note" placeholder="可補充社區停車、門禁、寵物、聯絡前需簡訊告知等資訊" rows="4"></textarea>
<details><summary>送出後流程</summary><p>我司將收到您的預約資料，人員會於「方便聯繫時間」內與您聯絡，確認細節與到府時間。</p></details>
</div>
<div class="section">
<h2>送出前預覽</h2>
<table id="preview"><tbody></tbody></table>
</div>
</div>
<div class="nav">
<a href="contact-info.html" id="back">← 返回上一步</a>
<button id="submit">完成填寫並送出</button>
</div>
</div>
<div class="ok" id="ok">
<div class="modal">
<h3>已送出</h3>
<p>感謝您填寫預約資料🙏</p>
<p>我們將盡快與您聯繫，安排最合適的清洗服務時段！</p>
</div>
</div>
<script>
  (function(){
    const KEY='BOOKING_DATA';
    const FN='/submit';
    const $=s=>document.querySelector(s);
    const $$=s=>Array.prototype.slice.call(document.querySelectorAll(s));

    function getLS(){
      try{ return JSON.parse(localStorage.getItem(KEY)||'{}'); }catch(e){ return {}; }
    }
    function collectForm(root=document){
      const out={};
      $$('input[name],select[name],textarea[name]', root).forEach(el=>{
        const n=el.name; if(!n) return;
        if(el.type==='checkbox'){
          if(!el.checked) return;
          let v=el.value;
          const oid=el.dataset.otherId;
          if(oid){
            const extra = ($('#'+oid)?.value||'').trim();
            if(extra) v = v+'：'+extra;
          }
          (out[n]||(out[n]=[])).push(v);
        }else{
          const v=(el.value||'').trim();
          if(v) out[n]=v;
        }
      });
      return out;
    }
    function preview(payload){
      const tbody = $('#preview tbody'); tbody.innerHTML='';
      const show = (k, label)=>{
        const v = payload[k];
        if(v==null || v==='' || (Array.isArray(v) && !v.length)) return;
        const txt = Array.isArray(v) ? v.join('、') : v;
        const tr = document.createElement('tr');
        tr.innerHTML = '<th>'+label+'</th><td>'+txt+'</td>';
        tbody.appendChild(tr);
      };
      show('service_category','服務類別');
      show('ac_type','冷氣類型');
      show('ac_count','清洗數量');
      show('indoor_floor','室內機所在樓層');
      show('ac_brand','冷氣品牌');
      show('ac_transformer_series','是否為變形金剛系列');
      show('anti_mold','防霉抗菌');
      show('ozone','臭氧消毒');
      show('washer_count','洗衣機台數');
      show('washer_floor','洗衣機樓層');
      show('tank_count','水塔顆數');
      show('pipe_service','水管清洗戶型');
      show('pipe_reason','水管清洗原因');
      show('contact_method','聯繫方式');
      show('social_name','LINE/FB 名稱');
      show('name','顧客姓名');
      show('phone','聯繫電話');
      show('address','地址');
      show('housing_type','居住地型態');
      show('contact_time_preference','方便聯繫時間');
      show('timeslot','可安排時段');
      show('note','備註');
    }

    function buildPayload(){
      const ls = getLS();
      const form = collectForm(document);
      const merged = Object.assign({}, ls, form, { _page:{title:document.title,path:location.pathname,url:location.href}, _final:true });
      return merged;
    }

    function refresh(){
      const p = buildPayload();
      window.lastPayload = p;
      preview(p);
    }

    refresh();
    document.addEventListener('change', refresh);
    document.addEventListener('input', refresh);

    $('#back')?.addEventListener('click', ()=>{
      localStorage.setItem(KEY, JSON.stringify(buildPayload()));
    }, {capture:true});

    $('#submit').addEventListener('click', async ()=>{
      const payload = buildPayload();
      try{
        const res = await fetch(FN,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
        const t = await res.text();
        if(!res.ok) throw new Error('['+res.status+'] '+t);
        $('#ok').style.display='flex';
        setTimeout(()=>{ localStorage.removeItem(KEY); location.href='index.html'; }, 1200);
      }catch(err){
        alert('提交失敗：'+err.message);
      }
    });
  })();
  </script>

<a aria-label="回首頁" class="fab-home" href="index.html">🏠</a>
</body>
</html>
