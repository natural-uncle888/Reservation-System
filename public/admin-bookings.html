
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>Cloudinary 預約詳情管理</title>
  <style>
    body { font-family: "Segoe UI", sans-serif; padding: 20px; background: #f9fafb; color: #111827; }
    .section { background: #fff; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .section h3 { margin-top: 0; color: #2563eb; }
    .row { display: flex; margin-bottom: 8px; }
    .label { width: 180px; color: #374151; font-weight: bold; }
    .value { flex: 1; }
    .empty { color: #9ca3af; }
  </style>
</head>
<body>
  <h1>預約詳情</h1>
  <div id="details">請從 Cloudinary 中選擇預約檔案以查看詳情</div>

  <script>
    // 解析 Cloudinary context.custom 並顯示資料
    function renderBookingDetails(customJson) {
      let p = {};
      try {
        p = typeof customJson === "string" ? JSON.parse(decodeURIComponent(customJson)) : customJson;
      } catch (e) {
        document.getElementById("details").innerHTML = "<p>無法解析預約資料</p>";
        return;
      }

      const nb = v => (v == null || String(v).trim() === "" ? "<span class='empty'>—</span>" : String(v).trim());
      const toLine = (label, val) => `<div class="row"><div class="label">${label}</div><div class="value">${nb(val)}</div></div>`;

      const service = [
        toLine("服務類別", p.service_category || p.service),
        toLine("冷氣類型", p.ac_type),
        toLine("清洗數量", p.ac_count || p.count),
        toLine("室內機所在樓層", p.indoor_floor || p.floor),
        toLine("冷氣品牌", p.ac_brand || p.brand),
        toLine("是否為「變形金剛系列」冷氣機型？", p.ac_transformer_series || p.is_inverter)
      ].join("");

      const addon = [
        toLine("冷氣防霉抗菌處理", p.anti_mold || p.antifungus ? "需要" : ""),
        toLine("臭氧殺菌消毒", p.ozone ? "需要" : "")
      ].join("");

      const other = [
        toLine("其他清洗服務", p.extra_service || p.other_service || "無")
      ].join("");

      const contact = [
        toLine("聯絡人", p.customer_name || p.name),
        toLine("聯絡電話", p.phone),
        toLine("LINE / Facebook", p.line_or_fb || p.line_id || p.fb_name),
        toLine("地址", p.address),
        toLine("備註", p.note),
        toLine("建立時間", new Date().toLocaleString("zh-TW", { hour12: false }))
      ].join("");

      const html = `
        <div class="section"><h3>服務資訊</h3>${service}</div>
        <div class="section"><h3>防霉・消毒｜加購服務專區</h3>${addon}</div>
        <div class="section"><h3>其他清洗服務</h3>${other}</div>
        <div class="section"><h3>聯繫資料</h3>${contact}</div>
      `;

      document.getElementById("details").innerHTML = html;
    }

    // ⚠️ 示範用範例資料，請串接 Cloudinary API 將 real context.custom 帶入這裡
    const sampleContextCustom = encodeURIComponent(JSON.stringify({
      service_category: "冷氣清洗",
      ac_type: "分離式冷氣",
      ac_count: "2台",
      indoor_floor: "1樓",
      ac_brand: "HITACHI 日立",
      ac_transformer_series: "不清楚（現場由人員判斷）",
      antifungus: true,
      ozone: true,
      extra_service: "無",
      customer_name: "林志謙",
      phone: "0912345678",
      line_or_fb: "jenskimo",
      address: "台北市大安區仁愛路四段",
      note: "可穿拖鞋"
    }));
    renderBookingDetails(sampleContextCustom);
  </script>
</body>
</html>
